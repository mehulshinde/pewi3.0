<script src="results_scripts.js"></script>
<!--
The results page is displayed as an iframe within index.html.
The graphics and table are generated by front end javascript, resultsDisplay.js

This page has numerous elements laid out that are added to by d3 framework. The
 d3 code is somewhat tedious, but works well for our purposes. This page really interacts
 with the upper level javascript.

There are year toggles and a few buttons on the page whose functionality have to be kept
  in mind. Also, the page is a psuedo-tabbed pag with two containers swapping visibility
  as users switch back and forth between them.

Much of the styling on the page is for elements that are not yet made, but will be added
  to the page by the javascript.

Cleaned and Prepared - August 2016
-->

<html>
<!--
/** Main page styling **/

/*.tabSelected {
    background-color: rgba(0, 0, 0, 0.6);
    position: relative;
    display: inline-block;
    overflow: hidden;
    max-width: 100%;
    height: auto;
}*/

/*When you hover over either tab, it will turn a slightly darker color
*/

/*#innerContainer {
    margin: 15px;
    font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
    color: #000000;
    font-size: 20px;
}*/


/** Graphics elements for first tab **/

/*.legend {
    font-size: 16px;
}*/

/*.chart {
    width: 660px;
    height: 400px;
    float: right;
    display: inline-block;
    margin-top: 40px;
}*/

/*#graphics {
    margin: 10px;
    height: 100px;
}*/ -->

<head>
  <meta charset="utf-8">
  <title>Workspace - Results</title>
  <!-- INCLUDES -->
  <!--css-->
  <link rel="stylesheet" type="text/css" href="style_resultFrame.css">
  <script src="results_scripts.js"></script>

</head>

<body>
  <div id="results-header">

    <div style="visibility:hidden;" id="upTo"></div>
    <div style="visibility:hidden;" id="landYear"></div>
    <div style="visibility:hidden;" id="ecoYear"></div>

    <!-- "Business bars graphic" by Flaticon (http://www.flaticon.com/) with free commercial use -->
    <div id="tab1" class="tabSelected" onclick="toggleToTab(1);"><img src="./imgs/graphIcon.png">
      <span class="tab1text">Graphics</span>
    </div>
    <!-- "Abacus silhouette" by Freepik (http://www.freepik.com/) with free commercial use -->
    <div id="tab2" class="tab" onclick="toggleToTab(2);"><img src="./imgs/numbersIcon.png">
      <span class="tab2text">Tables</span>
    </div>

  </div>

  <div id="centralContentHolder">
    <div id="innerContainer">
      <div id="graphics">
        <div id="contentsG">

          <div id="landUseTypeContainer" class="graph-section">
            <div id="yearHolder">
              <div id="yearArrows">
                <div id="yearUpLand" onclick="changeLandPieBy(1);" class="upArrow"></div>
                <div id="yearDownLand" onclick="changeLandPieBy(-1);" class="downArrow"></div>
              </div>
              <div id="toggleYearPie" onclick="switchLandPie(1)">To Categories</div>
            </div>
            <div id="landusePieChart"></div>
          </div>

          <!-- Aster HUD Deprecated, along with the functions that support it
                               code is left for future implementations, if needed -->
          <!--
                        <div id="asterChart"></div>

                        <div id="yearHolder2">
                            <div id="yearUpESI" onclick="changeESIAsterBy(1);" class="upArrow"></div>
                            <div id="yearDownESI" onclick="changeESIAsterBy(-1);" class="downArrow"></div>
                        </div>


                        <div id="asterHUD">
                            <div id="asterContainer"></div>
                        </div>
                        -->

          <div id="radarContainer" class="graph-section">
            <div id="radarChart"></div>
            <div id="radarLegend"></div>
            <div id="checks" class="check">
              <input id="checkboxYear1" class="yearCheckbox" checked onclick="radarPlotYearToggle(1);" type="checkbox">
              <input id="checkboxYear2" class="yearCheckbox" checked onclick="radarPlotYearToggle(2);" type="checkbox">
              <input id="checkboxYear3" class="yearCheckbox" checked onclick="radarPlotYearToggle(3);" type="checkbox">
            </div>
          </div>

          <div id="precipSection" class="graph-section">
            <div id="precipInfo" class="precipInfo"></div>
            <div id="precipTitle">
              <img src="./imgs/precipBack.png" alt="Precipitation">
            </div>
            <svg id="precipChart"></svg>
          </div>

          <div id="yieldRadarContainer" class="graph-section">

            <div id="yieldRadarLegend"></div>
            <div id="yieldRadarChart"></div>
            <div id="yieldChecks" class="check">
              <input type="checkbox" id="yieldCheckboxYear1" checked onclick="yieldRadarPlotYearToggle(1);" class="yearCheckbox">
              <input type="checkbox" id="yieldCheckboxYear2" checked onclick="yieldRadarPlotYearToggle(2);" class="yearCheckbox">
              <input type="checkbox" id="yieldCheckboxYear3" checked onclick="yieldRadarPlotYearToggle(3);" class="yearCheckbox">
            </div>
          </div>

        </div>
      </div>

      <div style="display:none;" id="numbers"><br>
        <div id="contentsN" style="margin:10px; margin-top:2px;"></div>
      </div>

    </div>
  </div>

</body>
<button id="download">download</button>
</html>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
<script>




download.addEventListener("click", function() {
  // only jpeg is supported by jsPDF
  console.log("download clicked");
var imgData;
html2canvas($("#contentsG"), {
            onrendered: function(canvas) {
                $('.element').css('position','absolute');
                theCanvas = canvas;
                console.log("download clicked");
               // var canvas2=document.getElementById("myCanvas");
               // var ctx2=canvas2.getContext("2d");
                var ctx = canvas.getContext("2d");
                // canvas.height=1000;
                // canvas.width=500;
                // ctx.fillRect(0, 0, 1000, 500);
                // ctx.fillStyle = "white";
                // ctx.fill();
             
//Giving the content a white background

           var imgData1=ctx.getImageData(0,0,canvas.width,canvas.height);
        var data=imgData1.data;
            for(var i=0;i<data.length;i+=4){
                if(data[i+3]<255){
                data[i] = 255 - data[i];
                data[i+1] = 255 - data[i+1];
                data[i+2] = 255 - data[i+2];
                data[i+3] = 255 - data[i+3];
    }
}

ctx.putImageData(imgData1,0,0);
//document.body.appendChild(canvas);
        imgData = canvas.toDataURL("image/jpeg", 1.0);

    var pdf = new jsPDF();

  pdf.addImage(imgData, 'JPEG', 0, 0);
  pdf.save("download.pdf");
                
            }
        });

var pdf = new jsPDF();

  pdf.addImage(imgData, 'JPEG', 0, 0);
html2canvas($("#tab1"), {
            onrendered: function(canvas) {
                $('.element').css('position','absolute');
                theCanvas = canvas;
                console.log("download clicked");
               // var canvas2=document.getElementById("myCanvas");
               // var ctx2=canvas2.getContext("2d");
                var ctx = canvas.getContext("2d");
                // canvas.height=1000;
                // canvas.width=500;
                // ctx.fillRect(0, 0, 1000, 500);
                // ctx.fillStyle = "white";
                // ctx.fill();
             
//Giving the content a white background

           var imgData1=ctx.getImageData(0,0,canvas.width,canvas.height);
        var data=imgData1.data;
            for(var i=0;i<data.length;i+=4){
                if(data[i+3]<255){
                data[i] = 255 - data[i];
                data[i+1] = 255 - data[i+1];
                data[i+2] = 255 - data[i+2];
                data[i+3] = 255 - data[i+3];
    }
}

ctx.putImageData(imgData1,0,0);
//document.body.appendChild(canvas);
        imgData = canvas.toDataURL("image/jpeg", 1.0);

    
                
            }
        });

pdf.addImage(imgData, 'JPEG', 0, 0);
  pdf.save("download.pdf");



  
}, false);

</script>
